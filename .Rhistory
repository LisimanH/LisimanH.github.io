# Note rbind requires field names to be consistent for every new thing that you add.
saveRDS(pge_gas, "pge_gas.rds")
}
pge_gas_filter <-
filter(
pge_gas,
CUSTOMERCLASS %in%
c(
"Gas- Residential",
"Gas- Commercial"
)
)
pge_gas_filter<-within(pge_gas_filter,kBTUs<-TOTALTHM*100000)
pge_gas_filter2 <- pge_gas_filter[,-c(7,8)]
pge_final<-rbind(pge_elec_filter2,pge_gas_filter2)
pge_mutate<-
mutate(pge_final,
DATE =
paste(
YEAR,
MONTH,
"01",
sep="-"
) %>% as.Date()
)
pge_commercial<-filter(pge_mutate,CUSTOMERCLASS%in%
c(
"Elec- Commercial",
"Gas- Commercial"
))
pge_residential<- filter(pge_mutate,CUSTOMERCLASS%in%
c(
"Elec- Residential",
"Gas- Residential"
))
library(plotly)
pge_chart_residential <-
pge_residential %>%
ggplot() +
geom_line(
aes(
x = DATE %>% factor(),
y = kBTUs,
color = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Months",
y = "kBTUs",
title = "PG&E Territory Monthly Residential Electricity and Gas Usage\n2017 Q1 - 2021 Q2",
color = "Usage Type"
) +
scale_x_discrete(guide = guide_axis(check.overlap = TRUE))
pge_chart_residential
pge_chart_residential <-
pge_residential %>%
ggplot() +
geom_line(
aes(
x = DATE %>% factor(),
y = kBTUs,
color = CUSTOMERCLASS
)
) +
labs(
x = "Months",
y = "kBTUs",
title = "PG&E Territory Monthly Residential Electricity and Gas Usage\n2017 Q1 - 2021 Q2",
color = "Usage Type"
) +
scale_x_discrete(guide = guide_axis(check.overlap = TRUE))
pge_chart_residential
knitr::opts_chunk$set(echo = F, warnings = F, messages = F )
install.packages(c("sf", "tigris", "censusapi", "mapview"))
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
ca_counties <- counties("CA", cb = T, progress_bar = F)
View(ca_counties)
mapview(ca_counties)
mapview(ca_counties)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
acs_vars_2019_5yr <-
listCensusMetadata(
name = "2019/acs/acs5",
type = "variables"
)
View(acs_vars_2019_5yr)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P001001
)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P001001"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P001001
)
View(smc_pop_2010)
View(smc_pop_2020)
View(smc_pop_2010)
View(smc_pop_2020)
Sys.setenv(CENSUS_KEY="5042355b73b371569968738cfc4f492be94675c1")
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
Sys.setenv(CENSUS_KEY="5042355b73b371569968738cfc4f492be94675c1")
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
smc_blockgroups <- block_groups("CA", "San Mateo", cb = T, progress_bar = F)
elderly_pal <- colorNumeric(
palette = "Blues",
domain =
smc_elderly$percent_elderly
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"sex","age"),
sep = "!!"
) %>%
filter(!is.na(age))
smc_elderly <-
smc_sexbyage %>%
mutate(
elderly =
ifelse(
age %in% c(
"65 and 66 years",
"67 to 69 years",
"70 to 74 years",
"75 to 79 years",
"80 to 84 years",
"85 years and over"
),
estimate,
NA
)
) %>%
group_by(cbg) %>%
summarize(
elderly = sum(elderly, na.rm = T),
total_pop = sum(estimate, na.rm = T)
) %>%
mutate(
percent_elderly = elderly/total_pop*100
) %>%
filter(!is.na(percent_elderly))
smc_blockgroups <- block_groups("CA", "San Mateo", cb = T, progress_bar = F)
elderly_pal <- colorNumeric(
palette = "Blues",
domain =
smc_elderly$percent_elderly
)
leaflet() %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
data =
smc_elderly %>%
left_join(
smc_blockgroups %>% select(GEOID),
by = c("cbg" = "GEOID")
) %>%
st_as_sf(),
fillColor = ~elderly_pal (percent_elderly),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1,
label = ~paste0(
round(percent_elderly),
"% over age 65"
),
highlightOptions = highlightOptions(
weight = 2,
opacity = 1
)
) %>%
addLegend(
data = smc_elderly,
pal = elderly_pal,
values = ~percent_elderly,
title = "% over 65"
)
View(smc_sexbyage)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
)
View(smc_sexbyage)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
)
View(smc_sexbyage)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
)
View(smc_sexbyage)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M")))
View(smc_sexbyage)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
)
View(smc_sexbyage)
View(acs_vars_2019_5yr)
smc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"sex","age"),
sep = "!!"
) %>%
filter(!is.na(age))
View(smc_elderly)
View(smc_blockgroups)
setwd("~/Documents/GitHub/LisimanHua.github.io")
library(tigris)
library(sf)
library(censusapi)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
smc_pop_race_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "group(P1)"
) %>%
mutate(
block =
paste0(state,county,tract,block)
) %>%
select(!c(GEO_ID,state,county,tract,NAME) & !ends_with(c("NA"))) %>%
pivot_longer(
ends_with("N"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
dec_vars_2020 %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,"category1","category2"),
sep = "!!"
)
View(smc_pop_2020)
View(smc_pop_race_2020)
dec_vars_2020 %>%
filter(grepl("P1",name)) %>%
select(name, label) %>%
arrange(name)
library(devtools)
install.packages("devtools")
library(devtools)
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
knitr::opts_chunk$set(echo = TRUE)
#install.packages("devtools")
library(devtools)
install.packages("Rcpp", dependencies = TRUE)
library(devtools)
devtools::install_github("r-transit/tidytransit")
install.packages("Rcpp")
library(devtools)
```{r}
library(tigris)
smc_blocks_2020 <- blocks("CA", "San Mateo", year = 2020, progress_bar = F)
nfo_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "North Fair Oaks")
